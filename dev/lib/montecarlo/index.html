<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Main module · MCIntegration.jl</title><meta name="title" content="Main module · MCIntegration.jl"/><meta property="og:title" content="Main module · MCIntegration.jl"/><meta property="twitter:title" content="Main module · MCIntegration.jl"/><meta name="description" content="Documentation for MCIntegration.jl."/><meta property="og:description" content="Documentation for MCIntegration.jl."/><meta property="twitter:description" content="Documentation for MCIntegration.jl."/><meta property="og:url" content="https://numericaleft.github.io/MCIntegration.jl/lib/montecarlo/"/><meta property="twitter:url" content="https://numericaleft.github.io/MCIntegration.jl/lib/montecarlo/"/><link rel="canonical" href="https://numericaleft.github.io/MCIntegration.jl/lib/montecarlo/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MCIntegration.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Reference</span><ul><li class="is-active"><a class="tocitem" href>Main module</a></li><li><a class="tocitem" href="../vegasmc/">Markov-chain based Vegas algorithm</a></li><li><a class="tocitem" href="../vegas/">Vegas algorithm</a></li><li><a class="tocitem" href="../mcmc/">Markov-chain Monte Carlo</a></li><li><a class="tocitem" href="../distribution/">Random Variables</a></li><li><a class="tocitem" href="../utility/">Utility</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Main module</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Main module</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/numericaleft/MCIntegration.jl/blob/master/docs/src/lib/montecarlo.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Main-module"><a class="docs-heading-anchor" href="#Main-module">Main module</a><a id="Main-module-1"></a><a class="docs-heading-anchor-permalink" href="#Main-module" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.Configuration" href="#MCIntegration.Configuration"><code>MCIntegration.Configuration</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct Configuration{NI,V,P,O,T}</code></pre><p>Struct that holds all the necessary parameters and variables for Monte Carlo integration.</p><p><strong>Parameters</strong></p><ul><li><code>NI</code> : Number of integrands</li><li><code>V</code> : Type of variables</li><li><code>P</code> : Type of user-defined data</li><li><code>O</code> : Type of observables </li><li><code>T</code> : Type of integrand</li></ul><p><strong>Static parameters</strong></p><ul><li><code>seed</code>: Seed to initialize the random number generator, also serves as the unique process ID of the configuration.</li><li><code>rng</code>: A MersenneTwister random number generator, seeded by <code>seed</code>.</li><li><code>userdata</code>: User-defined parameter.</li><li><code>var</code>: Tuple of variables. Each variable should derive from the abstract type <code>Variable</code> (see <code>variable.jl</code> for details). Using a tuple instead of a vector improves performance.</li></ul><p><strong>Integrands properties</strong></p><ul><li><code>neighbor::Vector{Tuple{Int, Int}}</code> : Vector of tuples defining neighboring integrands. Two neighboring integrands are directly connected in the Markov chain.   The <code>neighbor</code> vector defines an undirected graph showing how the integrands are connected. Only highly correlated integrands should be defined as neighbors to reduce autocorrelations.</li><li><code>dof::Vector{Vector{Int}}</code>: Degrees of freedom of each integrand, i.e., the dimensions in which each integrand can vary.</li><li><code>observable</code>: Observables required to calculate the integrands, will be used in the <code>measure</code> function call.</li><li><code>reweight</code>: Reweight factors for each integrand. The reweight factor of the normalization integrand (namely, the last element) is assumed to be 1.</li><li><code>visited</code>: The number of times each integrand is visited by the Markov chain.</li></ul><p><strong>Current MC state</strong></p><ul><li><code>step</code>: The number of Monte Carlo updates performed thus far.</li><li><code>norm</code>: The index of the normalization integrand. <code>norm</code> is larger than the index of any user-defined integrands.</li><li><code>normalization</code>: The accumulated normalization factor.</li><li><code>propose/accept</code>: Arrays to store the proposed and accepted updates for each integrand and variable.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/43549d48328e5079a7b9474598c683a434dd918c/src/configuration.jl#L40-L75">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.Configuration-Union{Tuple{}, Tuple{V}} where V" href="#MCIntegration.Configuration-Union{Tuple{}, Tuple{V}} where V"><code>MCIntegration.Configuration</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function Configuration(;
    var::Union{Variable,AbstractVector,Tuple}=(Continuous(0.0, 1.0),),
    dof::Union{Int,AbstractVector,AbstractMatrix}=[ones(Int, length(var))],
    type=Float64,  # type of the integrand
    obs::AbstractVector=zeros(Float64, length(dof)),
    reweight::Vector{Float64}=ones(length(dof) + 1),
    seed::Int=rand(Random.RandomDevice(), 1:1000000),
    userdata=nothing,
    neighbor::Union{Vector{Vector{Int}},Vector{Tuple{Int,Int}},Nothing}=nothing,
    kwargs...
)</code></pre><p>Create a Configuration struct for MC integration.</p><p><strong>Arguments</strong></p><ul><li><code>var</code>: Either a single <code>Variable</code>, a <code>CompositeVar</code>, or a tuple consisting of <code>Variable</code> and/or <code>CompositeVar</code> instances. Tuples are used to improve performance by ensuring type stability. By default, <code>var</code> is set to a tuple containing a single continuous variable, <code>(Continuous(0.0, 1.0),)</code>.</li><li><code>dof</code>: Degrees of freedom for each integrand, as a vector of integers. For example, <code>[[0, 1], [2, 3]]</code> means the first integrand has zero instances of var#1 and one of var#2; while the second integrand has two instances of var#1 and 3 of var#2. Defaults to <code>[ones(length(var))]</code>, i.e., one degree of freedom for each variable.</li><li><code>type</code>: Type of the integrand, Float64 by default.</li><li><code>obs</code>: Vector of observables needed to calculate the integrands, which will be used in the <code>measure</code> function call. </li><li><code>reweight</code>: Vector of reweight factors for each integrand. By default, all factors are initialized to one. Internally, a reweight factor of 1 will be appended to the end of the reweight vector, which is for the normalization integral.</li><li><code>seed</code>: Seed for the random number generator. This also serves as the unique identifier of the configuration. If it is <code>nothing</code>, then a random seed between 1 and 1,000,000 is generated. </li><li><code>userdata</code>: User data to pass to the integrand and the measurement.</li><li><code>neighbor</code>: Vector of tuples that define neighboring integrands. For example, <code>[(1, 2), (2, 3)]</code> means that the first and second integrands, and the second and third integrands, are neighbors. Neighboring integrands are directly connected in the Markov chain. By default, all integrands are connected in ascending order. Note that the normalization integral is automatically appended at the end of the integrand list and is considered as neighbor with the first user-defined integrand.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">cfg = Configuration(
    var = (Continuous(0.0, 1.0), Continuous(-1.0, 1.0)),
    dof = [[1, 1], [2, 0]],
    obs = [0.0, 0.0],
    seed = 1234,
    neighbor = [(1, 2)]
)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/43549d48328e5079a7b9474598c683a434dd918c/src/configuration.jl#L141-L176">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.Result" href="#MCIntegration.Result"><code>MCIntegration.Result</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct Result{O,C}</code></pre><p>the returned result of the MC integration.</p><p><strong>Members</strong></p><ul><li><code>mean</code>: mean of the MC integration</li><li><code>stdev</code>: standard deviation of the MC integration samples</li><li><code>chi2</code>: reduced chi-square of the MC integration samples</li><li><code>neval</code>: number of evaluations of the integrand</li><li><code>ignore</code>: ignore iterations untill <code>ignore</code></li><li><code>config</code>: configuration of the MC integration from the last iteration</li><li><code>iterations</code>: list of tuples [(data, error, Configuration), ...] from each iteration</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/43549d48328e5079a7b9474598c683a434dd918c/src/statistics.jl#L1-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.average" href="#MCIntegration.average"><code>MCIntegration.average</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function average(history, idx=1; init=1, max=length(history))</code></pre><p>Average the history[1:max]. Return the mean, standard deviation and chi2 of the history.</p><p><strong>Arguments</strong></p><ul><li><code>history</code>: a list of tuples, such as [(data, error, Configuration), ...]</li><li><code>idx</code>: the index of the integral</li><li><code>max</code>: the last index of the history to average with</li><li><code>init</code> : the first index of the history to average with</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/43549d48328e5079a7b9474598c683a434dd918c/src/statistics.jl#L187-L198">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.integrate-Tuple{Function}" href="#MCIntegration.integrate-Tuple{Function}"><code>MCIntegration.integrate</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function integrate(integrand::Function;
    solver::Symbol=:vegas, # :mcmc, :vegas, or :vegasmc
    config::Union{Configuration,Nothing}=nothing,
    neval=1e4, 
    niter=10, 
    block=16, 
    measure::Union{Nothing,Function}=nothing,
    measurefreq::Int=1,
    inplace::Bool=false,
    adapt=true,
    gamma=1.0, 
    reweight_goal::Union{Vector{Float64},Nothing}=nothing, 
    parallel::Symbol=:nothread,
    ignore::Int=adapt ? 1 : 0,
    debug=false, 
    verbose=-1, 
    kwargs...
)</code></pre><p>Calculate the integrals, collect statistics, and return a <code>Result</code> struct containing the estimates and errors.</p><p><strong>Arguments</strong></p><ul><li><code>integrand</code>: A user-provided function to compute the integrand values. The function signature differs based on the selected <code>solver</code> and whether computations are done in-place:<ul><li>For <code>solver = :vegas</code> or <code>:vegasmc</code>, the function should be either <code>integrand(var, config)</code> or <code>integrand(var, weights, config)</code> depending on whether <code>inplace</code> is <code>false</code> or <code>true</code> respectively. Here, <code>var</code> are the random variables and <code>weights</code> is an output array to store the calculated weights.</li><li>For <code>solver = :mcmc</code>, the function should be <code>integrand(idx, var, config)</code>, where <code>idx</code> is the index of the integrand component to be evaluated.</li></ul></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>solver</code>: Integration algorithm to use: <code>:vegas</code>, <code>:vegasmc</code>, or <code>:mcmc</code>. Default is <code>:vegas</code>.</li><li><code>config</code>: <code>Configuration</code> object for the integration. If <code>nothing</code>, a new one is created using <code>Configuration(; kwargs...)</code>.</li><li><code>neval</code>: Number of integrand evaluations per iteration (default: <code>1e4</code>).</li><li><code>niter</code>: Number of iterations for the integration process (default: <code>10</code>).</li><li><code>block</code>: Number of blocks for statistical independence assumption (default: <code>16</code>).</li><li><code>measure</code>: An optional measurement function. <ul><li>For <code>solver = :vegas</code> or <code>:vegasmc</code>, the function signature should be <code>measure(var, obs, relative_weights, config)</code>. Here, <code>obs</code> is a vector of observable values for each component of the integrand and <code>relative_weights</code> are the weights calculated from the integrand multiplied by the probability of the corresponding variables. </li><li>For <code>solver = :mcmc</code>, the signature should be <code>measure(idx, var, obs, relative_weight, config)</code>, where <code>obs</code> is the observable vector and <code>relative_weight</code> is the weight calculated from the <code>idx</code>-th integrand multiplied by the probability of the variables.</li></ul></li><li><code>measurefreq</code>: How often the measurement function is called (default: <code>1</code>).</li><li><code>inplace</code>: Whether to use the inplace version of the integrand. Default is <code>false</code>, which is more convenient for integrand with a few return values but may cause type instability. Only useful for the :vegas and :vegasmc solver.</li><li><code>adapt</code>: Whether to adapt the grid and the reweight factor (default: <code>true</code>).</li><li><code>gamma</code>: Learning rate of the reweight factor after each iteration (default: <code>1.0</code>).</li><li><code>reweight_goal</code>: The expected distribution of visited times for each integrand after reweighting. Default is <code>nothing</code>.</li><li><code>parallel</code>: Run different blocks in parallel. Options are <code>:thread</code> and <code>:nothread</code>. Default is <code>:nothread</code>.</li><li><code>ignore</code>: Ignore the iteration until the <code>ignore</code> round. By default, the first iteration is ignored if adapt=true, and none is ignored if adapt=false.</li><li><code>verbose</code>: Control the printing level of the iteration history and configuration. <ul><li><code>&lt;-1</code>:print nothing</li><li><code>-1</code>: print minimal information (Default)</li><li><code>0</code>: print iteration history</li><li><code>&gt;0</code>: print MC configuration every <code>verbose</code> seconds and print iteration history. </li></ul></li><li><code>debug</code>: Whether to print debug information such as type instability or float overflow (default: <code>false</code>).</li><li><code>kwargs</code>: Other keyword arguments for the <code>Configuration</code> constructor.</li></ul><p><strong>Returns</strong></p><p>Returns a <code>Result</code> struct containing the estimates and errors of the calculated integrals.</p><p><strong>Notes</strong></p><ul><li><p>In MPI mode, only the root process returns meaningful results. All other workers return <code>nothing</code>. Users should handle the returning results properly.</p></li><li><p>The solvers <code>:vegasmc</code> and <code>:vegas</code> automatically append a normalization integral to the end of the integrand vector. When providing <code>reweight_goal</code>, don&#39;t forget assign the weight (the last element) for this normalization integral.</p></li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">integrate((x, c)-&gt;(x[1]^2+x[2]^2); var = Continuous(0.0, 1.0), dof = [[2,],], verbose=-2, solver=:vegas)
Integral 1 = 0.6663652080622751 ± 0.000490978424216832   (reduced chi2 = 0.645)

julia&gt; integrate((x, f, c)-&gt; (f[1] = x[1]^2+x[2]^2); var = Continuous(0.0, 1.0), dof = [[2,],], verbose=-2, solver=:vegas, inplace=true)
Integral 1 = 0.6672083165915914 ± 0.0004919147870306026   (reduced chi2 = 2.54)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/43549d48328e5079a7b9474598c683a434dd918c/src/main.jl#L1-L68">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.report" href="#MCIntegration.report"><code>MCIntegration.report</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function report(result::Result, ignore=result.ignore; pick::Union{Function,AbstractVector}=obs -&gt; first(obs), name=nothing, verbose=0, io::IO=Base.stdout)</code></pre><p>print the summary of the result.  It will first print the configuration from the last iteration, then print the weighted average and standard deviation of the picked observable from each iteration.</p><p><strong>Arguments</strong></p><ul><li><code>result</code>: Result object contains the history from each iteration</li><li><code>ignore</code>: ignore the first # iterations.</li><li><code>pick</code>: The pick function is used to select one of the observable to be printed. The return value of pick function must be a Number.</li><li><code>name</code>: name of each picked observable. If name is not given, the index of the pick function will be used.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/43549d48328e5079a7b9474598c683a434dd918c/src/statistics.jl#L138-L149">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../vegasmc/">Markov-chain based Vegas algorithm »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 27 January 2024 01:50">Saturday 27 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
