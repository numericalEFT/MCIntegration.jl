<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Markov-chain Monte Carlo · MCIntegration.jl</title><meta name="title" content="Markov-chain Monte Carlo · MCIntegration.jl"/><meta property="og:title" content="Markov-chain Monte Carlo · MCIntegration.jl"/><meta property="twitter:title" content="Markov-chain Monte Carlo · MCIntegration.jl"/><meta name="description" content="Documentation for MCIntegration.jl."/><meta property="og:description" content="Documentation for MCIntegration.jl."/><meta property="twitter:description" content="Documentation for MCIntegration.jl."/><meta property="og:url" content="https://numericaleft.github.io/MCIntegration.jl/lib/mcmc/"/><meta property="twitter:url" content="https://numericaleft.github.io/MCIntegration.jl/lib/mcmc/"/><link rel="canonical" href="https://numericaleft.github.io/MCIntegration.jl/lib/mcmc/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MCIntegration.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../montecarlo/">Main module</a></li><li><a class="tocitem" href="../vegasmc/">Markov-chain based Vegas algorithm</a></li><li><a class="tocitem" href="../vegas/">Vegas algorithm</a></li><li class="is-active"><a class="tocitem" href>Markov-chain Monte Carlo</a></li><li><a class="tocitem" href="../distribution/">Random Variables</a></li><li><a class="tocitem" href="../utility/">Utility</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Markov-chain Monte Carlo</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Markov-chain Monte Carlo</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/numericaleft/MCIntegration.jl/blob/master/docs/src/lib/mcmc.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Markov-chain-Monte-Carlo"><a class="docs-heading-anchor" href="#Markov-chain-Monte-Carlo">Markov-chain Monte Carlo</a><a id="Markov-chain-Monte-Carlo-1"></a><a class="docs-heading-anchor-permalink" href="#Markov-chain-Monte-Carlo" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MCIntegration.MCMC.montecarlo-Union{Tuple{T}, Tuple{O}, Tuple{P}, Tuple{V}, Tuple{N}, Tuple{Configuration{N, V, P, O, T}, Function, Any}, Tuple{Configuration{N, V, P, O, T}, Function, Any, Any}, Tuple{Configuration{N, V, P, O, T}, Function, Any, Any, Any}, Tuple{Configuration{N, V, P, O, T}, Function, Vararg{Any, 4}}} where {N, V, P, O, T}" href="#MCIntegration.MCMC.montecarlo-Union{Tuple{T}, Tuple{O}, Tuple{P}, Tuple{V}, Tuple{N}, Tuple{Configuration{N, V, P, O, T}, Function, Any}, Tuple{Configuration{N, V, P, O, T}, Function, Any, Any}, Tuple{Configuration{N, V, P, O, T}, Function, Any, Any, Any}, Tuple{Configuration{N, V, P, O, T}, Function, Vararg{Any, 4}}} where {N, V, P, O, T}"><code>MCIntegration.MCMC.montecarlo</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function montecarlo(config::Configuration{N,V,P,O,T}, integrand::Function, neval,
    verbose=0, timer=[], debug=false;
    measurefreq::Int=1, measure::Union{Nothing,Function}=nothing, idx::Int=1) where {N,V,P,O,T}</code></pre><p>This algorithm computes high-dimensional integrals using a Markov-chain Monte Carlo (MCMC) method. It is particularly well-suited for cases involving multiple integrals over several variables. </p><p>The MCMC algorithm learns an optimal distribution, or &#39;ansatz&#39;, to best fit all integrands under consideration. Additionally, it introduces a normalization integral (with an integrand ~ 1) alongside the original integrals.</p><p>Assume we have two integrals to compute, <span>$f_1(x)$</span> and <span>$f_2(x, y)$</span>, where <span>$x$</span> and <span>$y$</span> are variables of different types. The algorithm aims to learn the distributions <span>$\rho_x(x)$</span> and <span>$\rho_y(y)$</span>, such that the quantities <span>$f_1(x)/\rho_x(x)$</span> and <span>$f_2(x, y)/\rho_x(x)/\rho_y(y)$</span> are as flat as possible.</p><p>Using the Metropolis-Hastings algorithm, the algorithm samples variables <span>$x$</span> and <span>$y$</span> based on the joint distribution:</p><p class="math-container">\[p(x, y) = r_0 \cdot \rho_x(x) \cdot \rho_y(y) + r_1 \cdot |f_1(x)| \cdot \rho_y(y) + r_2 \cdot |f_2(x, y)|\]</p><p>where <span>$r_i$</span> are reweighting factors ensuring equal contribution from all terms. The integrals are then estimated by averaging the observables <span>$f_1(x)\rho_y(y)/p(x, y)$</span> and <span>$f_2(x, y)/p(x, y)$</span>.</p><p>Setting <span>$r_0 = 1$</span> and <span>$r_{i&gt;0} = 0$</span> reduces this algorithm to the classic Vegas algorithm.</p><p>The key difference between this MCMC method and the :vegasmc solver lies in how the joint distribution <span>$p(x, y)$</span> is sampled. This MCMC solver uses the Metropolis-Hastings algorithm to sample each term in <span>$p(x, y)$</span> as well as the variables <span>$(x, y)$</span>. The MC configuration space thus consists of <code>(idx, x, y)</code>, where <code>idx</code> represents the index of the user-defined and normalization integrals. In contrast, the <code>:vegasmc</code> algorithm only samples the <code>(x, y)</code> space, explicitly calculating all terms in <span>$p(x, y)$</span> on-the-fly for a given set of <span>$x$</span> and <span>$y$</span>.</p><p>Note: When multiple integrals are involved, only one of them is sampled and measured at each Markov-chain Monte Carlo step!</p><p>While the MCMC method may be less efficient than the <code>:vegasmc or</code>:vegas<code>solvers for low-dimensional integrations, it exhibits superior efficiency and robustness when faced with a large number of integrals, a scenario where the</code>:vegasmc<code>and</code>:vegas` solvers tend to struggle.</p><p><strong>Arguments</strong></p><ul><li><p><code>integrand</code>: A user-defined function evaluating the integrand. The function should be <code>integrand(idx, var, config)</code>. Here, <code>idx</code> is the index of the integrand component to be evaluated, <code>var</code> are the random variables and <code>weights</code> is an output array to store the calculated weights. The last parameter passes the MC <code>Configuration</code> struct to the integrand, so that user has access to userdata, etc.</p></li><li><p><code>measure</code>: An optional user-defined function to accumulate the integrand weights into the observable. The function signature should be <code>measure(idx, var, obs, relative_weight, config)</code>. Here, <code>idx</code> is the integrand index, <code>obs</code> is a vector of observable values for each component of the integrand and <code>relative_weight</code> is the weight calculated from the <code>idx</code>-th integrand multiplied by the probability of the corresponding variables. </p></li></ul><p>The following are the snippets of the <code>integrand</code> and <code>measure</code> functions:</p><pre><code class="language-julia hljs">function integrand(idx, var, config)
    # calculate your integrand values
    # return integrand of the index idx
end</code></pre><pre><code class="language-julia hljs">function measure(idx, var, obs, relative_weight, config)
    # accumulates the weight into the observable
    # For example,
    # obs[idx] = relative_weight # integral idx
    # ...
end</code></pre><p><strong>Remark:</strong></p><ul><li><p>What if the integral result makes no sense?</p><p>One possible reason is the reweight factor. It is important for the Markov chain to visit the integrals with the similar frequency.  However, the weight of different integrals may be order-of-magnitude different. It is thus important to reweight the integrals.  Internally, the MC sampler try to reweight for each iteration. However, it could fail either 1) the total MC steps is too small so that  reweighting doesn&#39;t have enough time to show up; ii) the integrals are simply too different, and the internal reweighting subroutine is  not smart enough to figure out such difference. If 1) is the case, one either increase the neval. If 2) is the case, one may mannually  provide an array of reweight factors when initializes the <code>MCIntegration.configuration</code> struct. </p></li></ul><p><strong>Examples</strong></p><p>The following command calls the MC Vegas solver,</p><pre><code class="language-julia-repl hljs">julia&gt; integrate((idx, x, c)-&gt;(x[1]^2+x[2]^2); var = Continuous(0.0, 1.0), dof = [[2,],], verbose=-1, solver=:mcmc)
Integral 1 = 0.6757665376867902 ± 0.008655534861083898   (reduced chi2 = 0.681)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/numericaleft/MCIntegration.jl/blob/c901a8fbbcc25d700acfa303ec64ef02a95c7a3f/src/mcmc/montecarlo.jl#L7-L71">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../vegas/">« Vegas algorithm</a><a class="docs-footer-nextpage" href="../distribution/">Random Variables »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 3 January 2024 15:13">Wednesday 3 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
